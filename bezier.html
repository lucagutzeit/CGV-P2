<!DOCTYPE html>
<html style="margin:0 !important; padding: 0 !important">
<head>
    <meta charset="utf-8" />
    <title>Canvas</title>    
</head>
<body>
    <p style="text-align: center">Bezier N</p>
    <canvas id="beziers" height="400">
		Alternative content in case the browser 
		does not support Canvas.
	</canvas>
	<script>
		var canvas;
        var ctx;

		function P(x, y) {
			this.x = x;
			this.y = y;
		}
		function getRandomPoint(width, height) {			
			return new P(Math.floor(Math.random() * width),
					     Math.floor(Math.random() * height));
		}

		var max_bezier_depth = 6;    // max recursion depth -> 2^depth segments
		var num_points = 6;          // number of control/input point
		var CP = Array(num_points);
		var line_width = 2;
		var point_size = 8;
		var back_color = '#dadada';
		var line_color = '#0000a7';
		var point_color = '#c50000';

        function draw() {
			for (var i=0; i<num_points; i++) {
				CP[i] = getRandomPoint(canvas.width, canvas.height);
			}
			if (ctx) {
				ctx.fillStyle = back_color;
				ctx.fillRect(0, 0, canvas.width, canvas.height);	
				ctx.lineWidth = line_width;
				ctx.strokeStyle = line_color;
				bezier(CP);	
				
				// Stützpunkte zeichnen
				for (var i=0; i<num_points; i++) {
					point(CP[i]);
				}
			}
		}

		function point (P)
		{
			ctx.fillStyle = point_color;
			ctx.fillRect(P.x-point_size/2,P.y-point_size/2,point_size,point_size);
		}
		function line (P0, P1) {
			ctx.beginPath();
			ctx.moveTo(P0.x, P0.y);
			ctx.lineTo(P1.x, P1.y);
			ctx.stroke();
		}

		function bezier4 (P0, P1, P2, P3, depth) {
			if (depth === 0) line(P0, P3);
			else {
				var P01   = new P(0.5*(P0.x+P1.x), 0.5*(P0.y+P1.y));
				var P12   = new P(0.5*(P1.x+P2.x), 0.5*(P1.y+P2.y));
				var P23   = new P(0.5*(P2.x+P3.x), 0.5*(P2.y+P3.y));

				var P012  = new P(0.5*(P01.x+P12.x), 0.5*(P01.y+P12.y));
				var P123  = new P(0.5*(P12.x+P23.x), 0.5*(P12.y+P23.y));

				var P0123 = new P(0.5*(P012.x+P123.x), 0.5*(P012.y+P123.y));
			
				bezier4(P0, P01, P012, P0123, depth-1);
				bezier4(P0123, P123, P23, P3, depth-1);
			}
		}

		function bezierN (points, depth) {
			if(depth === 0) {
				line(points[0], points[points.length-1]);
			} else {
				var point_layers = Array(points.length);
				point_layers[0] = points; 

				for(var i=1; i<point_layers.length; i++) {
					point_layers[i] = Array(points.length-i);
				}

				for (var i = 1; i<points.length; i++){
					for(var j = 0; j<points.length-i; j++) {
						let pointA = point_layers[i-1][j];
						let pointB = point_layers[i-1][j+1]

						point_layers[i][j] = new P(0.5*(pointA.x+pointB.x), 0.5*(pointA.y+pointB.y));
					}
				}

				var new_points_left = Array(points.length);
				var new_points_right = Array(points.length);
				
				for(var k = 0; k < points.length; k++) {
					new_points_left[k] = point_layers[k][0];
					new_points_right[new_points_right.length-1-k] = point_layers[k][point_layers[k].length-1];
				}				

				bezierN(new_points_left, depth-1);
				bezierN(new_points_right, depth-1);
			}
		}

		function bezier (points) {
			bezierN(points, max_bezier_depth);
		}

        function resizer() {
            if (canvas.width != document.body.clientWidth) {
            canvas.width = document.body.clientWidth;
            console.log(canvas.width, canvas.height);
            draw();
            }
        }

        window.addEventListener('load', function () {
			canvas = document.getElementById('beziers');
			// check for browser support
			if (canvas && canvas.getContext) {
                canvas.width = document.body.clientWidth; 
				ctx = canvas.getContext('2d');
                canvas.addEventListener('mousedown', draw, false);
                window.addEventListener('resize', resizer, false);
				if (ctx) {
					draw();
				}
			}
		}, false);				
		
	</script>	
</body>
</html>
